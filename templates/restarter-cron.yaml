apiVersion: batch/v1
kind: CronJob
metadata:
  name: deployment-restart
spec:
  concurrencyPolicy: Forbid
  schedule: '0 12 * * *' # cron spec of time 12 UTC, here, 4 o'clock
  jobTemplate:
    spec:
      ttlSecondsAfterFinished: 60
      backoffLimit: 2 # this has very low chance of failing, as all this does
                      # is prompt kubernetes to schedule new replica set for
                      # the deployment
      activeDeadlineSeconds: 600 # timeout, makes most sense with
                                 # "waiting for rollout" variant specified below
      template:
        spec:
          serviceAccountName: deployment-restart # name of the service
                                                 # account configured above
          restartPolicy: Never
          containers:
            - name: kubectl
              image: rancher/kubectl:v1.22.2
              command:
              - kubectl
              - rollout
              - restart
              - deployment
              - {{ .Values.jackett.deployment.name }}
              - {{ .Values.overseerr.deployment.name }}
              - {{ .Values.transmission.deployment.name }}
              - {{ .Values.plex.deployment.name }}
              - {{ .Values.radarr.deployment.name }}
              - {{ .Values.sonarr.deployment.name }}

